<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="${base}/">
    <title>erupt-log</title>
    <link href="monitor/xterm.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Courier New';
            src: url('monitor/Courier-New.ttf');
        }
    </style>
</head>
<body style="margin: 0;">
<div style="background: #1e1f22;padding: 0 12px;position: fixed;left: 0;right: 0;top: 0;bottom: 0">
    <div id="terminal" style="width:100%;height:100%">

    </div>
</div>
<script src="element/axios.min.js"></script>
<script src="monitor/xterm.js"></script>
<script src="monitor/xterm-addon-fit.js"></script>
<!--<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/xterm/4.11.0/addons/search/xterm-addon-search.js"></script>-->
<script>
    const xterm = new Terminal({
        convertEol: true,
        fontFamily: `Courier New, 'Fira Mono', monospace`,
        fontSize: 13,
        lineHeight: 1.4,
        cursorBlink: true,
        disableStdin: true,
        theme: {
            background: "#1e1f22", //背景色
        }
    });
    var fitAddon = new FitAddon.FitAddon();
    xterm.loadAddon(fitAddon)
    // xterm.loadAddon(new SearchAddon());
    xterm.open(document.getElementById('terminal'));
    let offset = null;

    function getLog() {
        axios.get("erupt-api/tool/erupt-log.html", {
            headers: {
                token: parent.getAppToken().token,
            },
            params: {
                size: 500,
                offset: offset
            }
        }).then((res) => {
            for (let key in res.data) {
                xterm.writeln(res.data[key].content);
                offset = res.data[key].num;
            }
            if (res.data.length > 0) {
                fitAddon.fit()
            }
        }, error => {
            if (error.response) {
                if (error.response.status === 401) {
                    window.parent.location.reload();
                } else if (error.response.status === 403) {
                    window.location.href = "${base}/error/403.html"
                } else {
                    xterm.writeln(error.response.status + "→" + error.message);
                }
            } else {
                xterm.writeln(error.message);
                offset = null;
            }
        });
    }

    getLog();
    setInterval(function () {
        getLog();
    }, 1500)
    window.onresize = function () {
        fitAddon.fit()
    }
</script>
</body>
</html>